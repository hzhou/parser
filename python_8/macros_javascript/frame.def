fncode:: parse_javascript
    macros:
        pat_identifier: [a-zA-Z_\$]\w*

    #-- context ---------------
    subcode:: setup
        context_stack = []
        cur_context = {'type':"global", 'statements':[]}
        last_context= None

    subcode: start_context(type)
        cur_context = {"type":"$(type)"}
        stack.append: ("$(type)", "boc")
        context_stack.append: cur_context

    subcode: restart_context(type)
        # e.g. if (cond_context) if_block context 
        cur_context = last_context
        stack.append: ("$(type)", "boc")
        context_stack.append: cur_context

    subcode: pop_context
        last_context= cur_context
        cur_context = context_stack.pop()

    #-- return -------------
    subcode: return
        return cur_context

    #-- debug -------------
    fncode: synopsis(s, N, i, n)
        i0=i-N
        i1=i+N
        t_pre="..."
        t_post="..."

        $if i0<0
            i0=0
            t_pre=""
        $if i1>n
            i1=n
            t_post=""

        return (t_pre+s[i0:i], s[i:i1]+t_post)

    subcode: error(msg)
        (s0, s1)=synopsis(src, 40, src_pos, src_len)
        $print source: "$s0" + "$s1" 
        print "cur: ", cur
        print "stack: ", stack
        raise Exception($(msg))
